---
import Wrapper from "./Wrapper.astro";

const { title } = Astro.props;

// Le code ici s'exécute côté serveur au build
interface User {
    id: number;
    name: string;
    username: string;
    email: string;
    address: {
        street: string;
        suite: string;
        city: string;
        zipcode: string;
        geo: {
            lat: string;
            lng: string;
        };
    };
    phone: string;
    website: string;
    company: {
        name: string;
        catchPhrase: string;
        bs: string;
    };
}       

// Tu peux fournir des données initiales si tu veux
const initialUser: User = {
    id: 1,
    name: "Petros Lizano",
    username: "Petros",
    email: "petros@yasta.be",
    address: {
        street: "Kulas Light",
        suite: "Apt. 556",
        city: "Gwenborough",
        zipcode: "92998-3874",
        geo: {
            lat: "-37.3159",
            lng: "81.1496",
        },
    },
    phone: "1-770-736-8031 x56442",
    website: "yasta.be",
    company: {
        name: "Yasta",
        catchPhrase: "Multi-layered client-server neural-net",
        bs: "harness real-time e-markets",
    },
};
---

<article class="client-api bg-(--social-bg) p-4 rounded-lg">
    <h2 id="post-5" class="text-2xl font-bold">{title} <i class='text-red-500 bx bxs-x-square'>...à-revoir</i></h2>
    <hr>
    <div id="user-profile">
        <p>Chargement...</p>
    </div>
    <script define:vars={{initialUser}} is:inline>
        // Ce code s'exécute côté client
        const profilUser = document.getElementById("user-profile");
        
        // Utiliser les données initiales immédiatement
        renderProfile(initialUser)
        
        // Puis rafraîchir avec les données réelles
        fetch("https://jsonplaceholder.typicode.com/users/6")
        .then((res) => res.json())
        .then((user) => renderProfile(user))
        .catch((error) => { profilUser.innerHTML = `<p class="text-red-500">Erreur : ${error.message}</p>`; });
        
        function renderProfile(user ) {
            // Ici à regarder car n'est pas un Wrapper composant
            profilUser.innerHTML = `
                <div class="client-card flex items-center gap-4 my-4 border p-4 rounded-lg shadow hover:shadow-lg transition-all">
                    <img src="https://as1.ftcdn.net/v2/jpg/07/09/83/58/1000_F_709835878_HxLjezxYboiBs2PthGVmMYTE4zws9gPu.jpg" alt=${user.name} class="w-30 h-30 rounded-full object-cover border">
                    <div class="flex flex-col">
                        <h1 class="font-bold">${user.name}</h1>
                        <p>${user.email}</p>
                        <p>${user.phone}</p>
                    </div>
                </div>
            `;
        }
    </script>
</article>