---
import Wrapper from "./Wrapper.astro";

const { title } = Astro.props;

interface User {
    id: number;
    name: string;
    username: string;
    email: string;
    address: {
        street: string;
        suite: string;
        city: string;
        zipcode: string;
        geo: {
            lat: string;
            lng: string;
        };
    };
    phone: string;
    website: string;
    company: {
        name: string;
        catchPhrase: string;
        bs: string;
    };
}

let user: User | null = null;
let error : string | null = null;

try {
    const response = await fetch("https://jsonplaceholder.typicode.com/users/2");
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    user = await response.json();
} catch (err) {
    error = err instanceof Error ? err.message : "An unknown error occurred";
}
const avatar = "https://as2.ftcdn.net/v2/jpg/14/40/53/47/1000_F_1440534709_z2Rpp0BmW1wMfUIDc2rs5fpg8EmYgmXy.jpg"
---

{error 
    ? (<p style="color: red;">Erreur: {error}</p>) 
    : user 
        ? (
            <article class="loading-api bg-(--social-bg) p-4 rounded-lg">
                <h2 id="post-4">{title}</h2>
                <hr class="border-(--social)">
                <div class="list-users py-4">
                    <Wrapper { ...user } avatar={avatar}/>
                </div>
            </article>
        ) 
        : (
            <p>Chargement...</p>
        )
}
